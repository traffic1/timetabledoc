# 步骤3，纵向调整-均匀初始化时刻表明细的发车间隙
> 按照每个时间段的车辆数，计算发车间隙，高峰做多不能超过20分钟，重新计算所有班次的发车时间，到达时间，行驶时间，具体步骤如下：

## 一，重新组合整个上行班次链，下行班次链，组合成数组，并按照发车时间升序排序
![](/assets/step3_3.png)
* 上图中，生成两个数组，分别保存上行，下行班次对象，并按照发车时间排序，班次对象中包含路牌信息
* 上图中，有些班次是不在首末班车时间范围内的，这是由于步骤2产生的（具体参看步骤2的斜线法产生每个路牌的开始班次时间），后续不参与计算

## 二，对班次链再一次计算，按照时间段分隔班次，循环时间段重新计算发车时间等数据
![](/assets/step3_4.png)
1. 以上行班次链为例，从首班车时间开始计算，一直到末班车时间为止
2. 从首班车发车时间7:00计算第一个周转时间，7:00在高峰时间段内，使用高峰周转时间70分钟。加上发车时间，得到循环的结束时间8:10
3. 从7:00到8:10分时间段获取班次集合，计算包含的路牌数=车辆数，计算发车间隙＝周转时间/路牌数＝70/4，向上取整=18
4. 修改原来的班次发车时间，到达时间，行驶时间



